FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgQ2xvdWQtTmF0\
aXZlIFdvcmtzaG9wIG9uIGFuIE9wZW5TaGlmdCBjbHVzdGVyCmJpbmRhYmxlOiBGYWxzZQphc3lu\
Yzogb3B0aW9uYWwKdGFnczoKLSB3b3Jrc2hvcAptZXRhZGF0YToKICBkZXBlbmRlbmNpZXM6IFtd\
CiAgZGlzcGxheU5hbWU6ICJDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5zdGFsbGVyIgogIGxvbmdE\
ZXNjcmlwdGlvbjogIkluc3RhbGxzIHRoZSByZXF1aXJlZCBjb21wb25lbnRzIChHaXQgc2VydmVy\
LCBOZXh1cywgRWNsaXBzZSBDaGUsIGV0YykgZm9yIHJ1bm5pbmcgdGhlIENsb3VkLU5hdGl2ZSBX\
b3Jrc2hvcCIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6ICJwZmljb24gcGZpY29u\
LXByb2Nlc3MtYXV0b21hdGlvbiIKICBwcm92aWRlckRpc3BsYXlOYW1lOiAiUmVkIEhhdCwgSW5j\
LiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlwdGlvbjogRGVwbG95cyBDbG91\
ZC1OYXRpdmUgV29ya3Nob3AgSW5mcmFzdHJ1Y3R1cmUKICAgIGZyZWU6IFRydWUKICAgIG1ldGFk\
YXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgcGFyYW1ldGVyczoKICAgIC0gbmFt\
ZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJuYW1lCiAgICAgIGRlc2NyaXB0aW9u\
OiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0IGFkbWluIHJlc291cmNlcwog\
ICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91\
cDogT3BlblNoaWZ0IFVzZXIKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3Bhc3N3b3JkCiAgICAgIHRp\
dGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogUGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9y\
IGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3VyY2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAg\
ICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHBhc3N3b3JkCiAgICAgIGRpc3Bs\
YXlfZ3JvdXA6IE9wZW5TaGlmdCBVc2VyCiAgICAtIG5hbWU6IGdpdGh1Yl9yZWYKICAgICAgdGl0\
bGU6IEd1aWRlcyBHaXRIdWIgUmVmZXJlbmNlCiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgR2l0SHVi\
IHJlZmVyZW5jZSBmb3IgdGhlIENsb3VkLU5hdGl2ZSB3b3Jrc2hvcCBsYWIgZ3VpZGUKICAgICAg\
dHlwZTogZW51bQogICAgICBlbnVtOiBbIm9jcC0zLjkiLCAib2NwLTMuNyJdCiAgICAgIGRlZmF1\
bHQ6IG9jcC0zLjkKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBzZWxl\
Y3QKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRlCiAgICAtIG5hbWU6IHByb2plY3Rfc3Vm\
Zml4CiAgICAgIHRpdGxlOiBVc2VyIFByb2plY3QgU3VmZml4CiAgICAgIGRlc2NyaXB0aW9uOiBU\
aGUgcGF0dGVybiB1c2VkIGluIHRoZSBsYWIgZ3VpZGUgdG8gc2hvdyB0aGUgdXNlciBwcm9qZWN0\
cyBlLmcuIGNvb2xzdG9yZS1YWCAKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICIt\
WFgiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IExhYiBHdWlkZQog\
ICAgLSBuYW1lOiBnb2dzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBHb2dzIEFkbWluIFVzZXIKICAg\
ICAgZGVzY3JpcHRpb246IEFkbWluIHVzZXIgZm9yIEdvZ3MgR2l0IFNlcnZlcgogICAgICB0eXBl\
OiBzdHJpbmcKICAgICAgZGVmYXVsdDogImdvZ3MiCiAgICAgIHJlcXVpcmVkOiB0cnVlCiAgICAg\
IGRpc3BsYXlfZ3JvdXA6IEdpdCBTZXJ2ZXIKICAgIC0gbmFtZTogZ29nc19kZXZfdXNlcgogICAg\
ICB0aXRsZTogR29ncyBVc2VyCiAgICAgIGRlc2NyaXB0aW9uOiBVc2VyIGZvciBHb2dzIEdpdCBT\
ZXJ2ZXIKICAgICAgdHlwZTogc3RyaW5nCiAgICAgIGRlZmF1bHQ6ICJkZXZlbG9wZXIiCiAgICAg\
IHJlcXVpcmVkOiB0cnVlCiAgICAgIGRpc3BsYXlfZ3JvdXA6IEdpdCBTZXJ2ZXIKICAgIC0gbmFt\
ZTogZ29nc19wd2QKICAgICAgdGl0bGU6IEdvZ3MgUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246\
IFBhc3N3b3JkIGZvciBHb2dzIGFkbWluIHVzZXIgYW5kIG5vcm1hbCB1c2VyCiAgICAgIHR5cGU6\
IHN0cmluZwogICAgICBkZWZhdWx0OiAib3BlbnNoaWZ0IgogICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICBkaXNwbGF5X2dyb3VwOiBHaXQgU2VydmVy"

COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
