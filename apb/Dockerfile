FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLWFwYjMKZGVzY3JpcHRpb246\
IEFQQiB0byBkZXBsb3kgcmVxdWlyZWQgaW5mcmEgY29tcG9uZW50cyBmb3IgdGhlIENsb3VkLU5h\
dGl2ZSBXb3Jrc2hvcCBvbiBhbiBPcGVuU2hpZnQgY2x1c3RlcgpiaW5kYWJsZTogRmFsc2UKYXN5\
bmM6IG9wdGlvbmFsCnRhZ3M6Ci0gd29ya3Nob3AKbWV0YWRhdGE6CiAgZGVwZW5kZW5jaWVzOiBb\
XQogIGRpc3BsYXlOYW1lOiAiQ2xvdWQtTmF0aXZlIFdvcmtzaG9wIEluc3RhbGxlciAzIgogIGxv\
bmdEZXNjcmlwdGlvbjogIkluc3RhbGxzIHRoZSBsYWIgaW5zdHJ1Y3Rpb25zIGFuZCByZXF1aXJl\
ZCBjb21wb25lbnRzIChHaXQgc2VydmVyLCBOZXh1cywgRWNsaXBzZSBDaGUsIGV0YykgZm9yIHJ1\
bm5pbmcgdGhlIENsb3VkLU5hdGl2ZSBXb3Jrc2hvcCBodHRwczovL2dpdGh1Yi5jb20vb3BlbnNo\
aWZ0LWxhYnMvY2xvdWQtbmF0aXZlLWd1aWRlcyIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29u\
Q2xhc3M6ICJwZmljb24gcGZpY29uLXByb2Nlc3MtYXV0b21hdGlvbiIKICBwcm92aWRlckRpc3Bs\
YXlOYW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNj\
cmlwdGlvbjogRGVwbG95cyBDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5mcmFzdHJ1Y3R1cmUKICAg\
IGZyZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAg\
cGFyYW1ldGVyczoKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJu\
YW1lCiAgICAgIGRlc2NyaXB0aW9uOiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9q\
ZWN0IGFkbWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRy\
dWUKICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgIC0gbmFtZTog\
b3BlbnNoaWZ0X3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlv\
bjogUGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3Vy\
Y2VzCiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5\
X3R5cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1pbiBVc2Vy\
CiAgICAtIG5hbWU6IG9wZW5zaGlmdF9tYXN0ZXJfdXJsCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQg\
TWFzdGVyIFVSTAogICAgICBkZXNjcmlwdGlvbjogVGhlIGFkZHJlc3MgdG8gT3BlblNoaWZ0IG1h\
c3RlciBVUkwgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRz\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5\
cGU6IHN0cmluZwogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogb3Bl\
bnNoaWZ0X3VzZXJfcGFzc3dvcmQKICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBhc3N3b3Jk\
CiAgICAgIGRlc2NyaXB0aW9uOiBUaGUgT3BlblNoaWZ0IHBhc3N3b3JkIGZvciBwYXJ0aWNpcGFu\
dHMgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAg\
IHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHN0\
cmluZwogICAgICB2YWx1ZTogIm9wZW5zaGlmdCIKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1\
aWRlCiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fdXNlcgogICAgICB0aXRsZTogSW5mcmEgU2Vy\
dmljZXMgQWRtaW4gVXNlcgogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgaW5mcmFz\
dHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKQogICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgZGVmYXVsdDogImFkbWludXNlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxh\
eV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZpY2Vz\
CiAgICAtIG5hbWU6IGluZnJhc3Zjc19hZG1fcHdkCiAgICAgIHRpdGxlOiBJbmZyYSBTZXJ2aWNl\
cyBBZG1pbiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogQWRtaW4gcGFzc3dvcmQgZm9yIGlu\
ZnJhc3RydWN0dXJlIHNlcnZpY2VzIChHb2dzLCBDaGUsIC4uLikKICAgICAgdHlwZTogc3RyaW5n\
CiAgICAgIGRlZmF1bHQ6ICJhZG1pbnB3ZCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlz\
cGxheV90eXBlOiB0ZXh0CiAgICAgIGRpc3BsYXlfZ3JvdXA6IFdvcmtzaG9wIEluZnJhIFNlcnZp\
Y2Vz"



COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
