FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgQ2xvdWQtTmF0\
aXZlIFdvcmtzaG9wIG9uIGFuIE9wZW5TaGlmdCBjbHVzdGVyCmJpbmRhYmxlOiBGYWxzZQphc3lu\
Yzogb3B0aW9uYWwKdGFnczoKLSB3b3Jrc2hvcAptZXRhZGF0YToKICBkZXBlbmRlbmNpZXM6IFtd\
CiAgZGlzcGxheU5hbWU6ICJDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5zdGFsbGVyIgogIGxvbmdE\
ZXNjcmlwdGlvbjogIkluc3RhbGxzIHRoZSBsYWIgaW5zdHJ1Y3Rpb25zIGFuZCByZXF1aXJlZCBj\
b21wb25lbnRzIChHaXQgc2VydmVyLCBOZXh1cywgRWNsaXBzZSBDaGUsIGV0YykgZm9yIHJ1bm5p\
bmcgdGhlIENsb3VkLU5hdGl2ZSBXb3Jrc2hvcCBodHRwczovL2dpdGh1Yi5jb20vb3BlbnNoaWZ0\
LWxhYnMvY2xvdWQtbmF0aXZlLWd1aWRlcyIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xh\
c3M6ICJwZmljb24gcGZpY29uLXByb2Nlc3MtYXV0b21hdGlvbiIKICBwcm92aWRlckRpc3BsYXlO\
YW1lOiAiUmVkIEhhdCwgSW5jLiIKcGxhbnM6CiAgLSBuYW1lOiBkZWZhdWx0CiAgICBkZXNjcmlw\
dGlvbjogRGVwbG95cyBDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5mcmFzdHJ1Y3R1cmUKICAgIGZy\
ZWU6IFRydWUKICAgIG1ldGFkYXRhOgogICAgICBkaXNwbGF5TmFtZTogRGVmYXVsdAogICAgcGFy\
YW1ldGVyczoKICAgIC0gbmFtZTogb3BlbnNoaWZ0X3VzZXIKICAgICAgdGl0bGU6IFVzZXJuYW1l\
CiAgICAgIGRlc2NyaXB0aW9uOiBVc2VyIGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBwcm9qZWN0\
IGFkbWluIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAgICAgcmVxdWlyZWQ6IHRydWUK\
ICAgICAgZGlzcGxheV9ncm91cDogT3BlblNoaWZ0IEFkbWluIFVzZXIKICAgIC0gbmFtZTogb3Bl\
bnNoaWZ0X3Bhc3N3b3JkCiAgICAgIHRpdGxlOiBQYXNzd29yZAogICAgICBkZXNjcmlwdGlvbjog\
UGFzc3dvcmQgaXMgcmVxdWlyZWQgZm9yIGNyZWF0aW5nIHByb2plY3QgYWRtaW4gcmVzb3VyY2Vz\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5\
cGU6IHBhc3N3b3JkCiAgICAgIGRpc3BsYXlfZ3JvdXA6IE9wZW5TaGlmdCBBZG1pbiBVc2VyCiAg\
ICAtIG5hbWU6IG9wZW5zaGlmdF9tYXN0ZXJfdXJsCiAgICAgIHRpdGxlOiBPcGVuU2hpZnQgTWFz\
dGVyIFVSTAogICAgICBkZXNjcmlwdGlvbjogVGhlIGFkZHJlc3MgdG8gT3BlblNoaWZ0IG1hc3Rl\
ciBVUkwgdG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAg\
ICAgIHR5cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6\
IHN0cmluZwogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogb3BlbnNo\
aWZ0X3VzZXJfcGFzc3dvcmQKICAgICAgdGl0bGU6IE9wZW5TaGlmdCBVc2VyIFBhc3N3b3JkCiAg\
ICAgIGRlc2NyaXB0aW9uOiBUaGUgT3BlblNoaWZ0IHBhc3N3b3JkIGZvciBwYXJ0aWNpcGFudHMg\
dG8gYmUgZGlzcGxheWVkIGluIHRoZSBsYWIgZ3VpZGUgdG8gcGFydGljaXBhbnRzCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHN0cmlu\
ZwogICAgICB2YWx1ZTogInIzZGg0dDEhIgogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUK\
ICAgIC0gbmFtZTogaW5mcmFzdmNzX2FkbV91c2VyCiAgICAgIHRpdGxlOiBJbmZyYSBTZXJ2aWNl\
cyBBZG1pbiBVc2VyCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiB1c2VyIGZvciBpbmZyYXN0cnVj\
dHVyZSBzZXJ2aWNlcyAoR29ncywgQ2hlLCAuLi4pCiAgICAgIHR5cGU6IHN0cmluZwogICAgICBk\
ZWZhdWx0OiAiYWRtaW51c2VyIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5\
cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AgSW5mcmEgU2VydmljZXMKICAg\
IC0gbmFtZTogaW5mcmFzdmNzX2FkbV9wd2QKICAgICAgdGl0bGU6IEluZnJhIFNlcnZpY2VzIEFk\
bWluIFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiBwYXNzd29yZCBmb3IgaW5mcmFz\
dHJ1Y3R1cmUgc2VydmljZXMgKEdvZ3MsIENoZSwgLi4uKQogICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgZGVmYXVsdDogImFkbWlucHdkIgogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5\
X3R5cGU6IHRleHQKICAgICAgZGlzcGxheV9ncm91cDogV29ya3Nob3AgSW5mcmEgU2VydmljZXMK\
ICAgIC0gbmFtZTogZ29nc19kZXZfdXNlcgogICAgICB0aXRsZTogR29ncyBVc2VyCiAgICAgIGRl\
c2NyaXB0aW9uOiBVc2VyIGZvciBHb2dzIFNlcnZlcgogICAgICB0eXBlOiBzdHJpbmcKICAgICAg\
ZGVmYXVsdDogImRldmVsb3BlciIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9n\
cm91cDogR2l0IFNlcnZlcgogICAgLSBuYW1lOiBnb2dzX3B3ZAogICAgICB0aXRsZTogR29ncyBQ\
YXNzd29yZAogICAgICBkZXNjcmlwdGlvbjogUGFzc3dvcmQgZm9yIEdvZ3MgdXNlcgogICAgICB0\
eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDogIm9wZW5zaGlmdCIKICAgICAgcmVxdWlyZWQ6IHRy\
dWUKICAgICAgZGlzcGxheV9ncm91cDogR2l0IFNlcnZlcg=="

COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
