FROM ansibleplaybookbundle/apb-base

LABEL "com.redhat.apb.spec"=\
"dmVyc2lvbjogMS4wCm5hbWU6IGNsb3VkbmF0aXZlLXdvcmtzaG9wLWFwYgpkZXNjcmlwdGlvbjog\
QVBCIHRvIGRlcGxveSByZXF1aXJlZCBpbmZyYSBjb21wb25lbnRzIGZvciB0aGUgQ2xvdWQtTmF0\
aXZlIFdvcmtzaG9wIG9uIGFuIE9wZW5TaGlmdCBjbHVzdGVyCmJpbmRhYmxlOiBGYWxzZQphc3lu\
Yzogb3B0aW9uYWwKdGFnczoKLSB3b3Jrc2hvcAptZXRhZGF0YToKICBkZXBlbmRlbmNpZXM6IFtd\
CiAgZGlzcGxheU5hbWU6ICJDbG91ZC1OYXRpdmUgV29ya3Nob3AgSW5zdGFsbGVyIChBUEIpIgog\
IGxvbmdEZXNjcmlwdGlvbjogIkluc3RhbGxzIHRoZSByZXF1aXJlZCBjb21wb25lbnRzIChHaXQg\
c2VydmVyLCBOZXh1cywgRWNsaXBzZSBDaGUsIGV0YykgZm9yIHJ1bm5pbmcgdGhlIENsb3VkLU5h\
dGl2ZSBXb3Jrc2hvcCIKICBjb25zb2xlLm9wZW5zaGlmdC5pby9pY29uQ2xhc3M6IGljb24tb3Bl\
bnNoaWZ0CiAgcHJvdmlkZXJEaXNwbGF5TmFtZTogIlJlZCBIYXQsIEluYy4iCnBsYW5zOgogIC0g\
bmFtZTogZGVmYXVsdAogICAgZGVzY3JpcHRpb246IERlcGxveXMgQ2xvdWQtTmF0aXZlIFdvcmtz\
aG9wIEluZnJhc3RydWN0dXJlCiAgICBmcmVlOiBUcnVlCiAgICBtZXRhZGF0YToKICAgICAgZGlz\
cGxheU5hbWU6IERlZmF1bHQKICAgIHBhcmFtZXRlcnM6CiAgICAtIG5hbWU6IGFkbWluX3VzZXIK\
ICAgICAgdGl0bGU6IEFkbWluIFVzZXJuYW1lCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiB1c2Vy\
IGlzIHJlcXVpcmVkIGZvciBjcmVhdGluZyBjbHVzdGVyLXdpZGUgcmVzb3VyY2VzCiAgICAgIHR5\
cGU6IHN0cmluZwogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X2dyb3VwOiBPcGVu\
U2hpZnQgQWRtaW4KICAgIC0gbmFtZTogYWRtaW5fcGFzc3dvcmQKICAgICAgdGl0bGU6IEFkbWlu\
IFBhc3N3b3JkCiAgICAgIGRlc2NyaXB0aW9uOiBBZG1pbiBwYXNzd29yZCBpcyByZXF1aXJlZCBm\
b3IgY3JlYXRpbmcgY2x1c3Rlci13aWRlIHJlc291cmNlcwogICAgICB0eXBlOiBzdHJpbmcKICAg\
ICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV90eXBlOiBwYXNzd29yZAogICAgICBkaXNw\
bGF5X2dyb3VwOiBPcGVuU2hpZnQgQWRtaW4KICAgIC0gbmFtZTogZ2l0aHViX3JlZgogICAgICB0\
aXRsZTogR3VpZGVzIEdpdEh1YiBSZWZlcmVuY2UKICAgICAgZGVzY3JpcHRpb246IFRoZSBHaXRI\
dWIgcmVmZXJlbmNlIGZvciB0aGUgQ2xvdWQtTmF0aXZlIHdvcmtzaG9wIGxhYiBndWlkZQogICAg\
ICB0eXBlOiBlbnVtCiAgICAgIGVudW06IFsib2NwLTMuOSIsICJvY3AtMy43Il0KICAgICAgZGVm\
YXVsdDogb2NwLTMuOQogICAgICByZXF1aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X3R5cGU6IHNl\
bGVjdAogICAgICBkaXNwbGF5X2dyb3VwOiBMYWIgR3VpZGUKICAgIC0gbmFtZTogcHJvamVjdF9z\
dWZmaXgKICAgICAgdGl0bGU6IFVzZXIgUHJvamVjdCBTdWZmaXgKICAgICAgZGVzY3JpcHRpb246\
IFRoZSBwYXR0ZXJuIHVzZWQgaW4gdGhlIGxhYiBndWlkZSB0byBzaG93IHRoZSB1c2VyIHByb2pl\
Y3RzIGUuZy4gY29vbHN0b3JlLVhYIAogICAgICB0eXBlOiBzdHJpbmcKICAgICAgZGVmYXVsdDog\
Ii1YWCIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAgZGlzcGxheV9ncm91cDogTGFiIEd1aWRl\
CiAgICAtIG5hbWU6IGdvZ3NfYWRtaW4KICAgICAgdGl0bGU6IEdvZ3MgQWRtaW4gVXNlcgogICAg\
ICBkZXNjcmlwdGlvbjogQWRtaW4gdXNlciBmb3IgR29ncyBHaXQgU2VydmVyCiAgICAgIHR5cGU6\
IHN0cmluZwogICAgICBkZWZhdWx0OiAiZ29ncyIKICAgICAgcmVxdWlyZWQ6IHRydWUKICAgICAg\
ZGlzcGxheV9ncm91cDogR2l0IFNlcnZlcgogICAgLSBuYW1lOiBnb2dzX3VzZXIKICAgICAgdGl0\
bGU6IEdvZ3MgVXNlcgogICAgICBkZXNjcmlwdGlvbjogVXNlciBmb3IgR29ncyBHaXQgU2VydmVy\
CiAgICAgIHR5cGU6IHN0cmluZwogICAgICBkZWZhdWx0OiAiZGV2ZWxvcGVyIgogICAgICByZXF1\
aXJlZDogdHJ1ZQogICAgICBkaXNwbGF5X2dyb3VwOiBHaXQgU2VydmVyCiAgICAtIG5hbWU6IGdv\
Z3NfcGFzc3dvcmQKICAgICAgdGl0bGU6IEdvZ3MgUGFzc3dvcmQKICAgICAgZGVzY3JpcHRpb246\
IFBhc3N3b3JkIGZvciBHb2dzIGFkbWluIHVzZXIgYW5kIG5vcm1hbCB1c2VyCiAgICAgIHR5cGU6\
IHN0cmluZwogICAgICBkZWZhdWx0OiAib3BlbnNoaWZ0IgogICAgICByZXF1aXJlZDogdHJ1ZQog\
ICAgICBkaXNwbGF5X2dyb3VwOiBHaXQgU2VydmVy"

COPY playbooks /opt/apb/actions
ADD requirements.yml /opt/apb/actions/requirements.yml
RUN ansible-galaxy install -r /opt/apb/actions/requirements.yml -f
RUN chmod -R g=u /opt/{ansible,apb}
USER apb
